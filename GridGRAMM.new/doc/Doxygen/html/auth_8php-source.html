<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GridGRAMM: auth.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>auth.php</h1><a href="auth_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 &lt;!DOCTYPE HTML PUBLIC <span class="stringliteral">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="stringliteral">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;
00002 
00003 &lt;html&gt;
00004 &lt;head&gt;
00005         &lt;meta http-equiv=<span class="stringliteral">"Content-Type"</span> content=<span class="stringliteral">"text/html; charset=UTF-8"</span> &gt;
00006         &lt;title&gt;Results&lt;/title&gt;
00007 &lt;/head&gt;
00008 
00009 &lt;?<span class="comment"></span>
00010 <span class="comment">/**</span>
00011 <span class="comment"> * General utility functions</span>
00012 <span class="comment"> */</span>
00013 require(<span class="stringliteral">"./functions.php"</span>);
00014 
00015 <a class="code" href="auth_8php.html#a0">$username</a>=$_POST[<span class="stringliteral">"username"</span>];
00016 <a class="code" href="auth_8php.html#a1">$password</a>=$_POST[<span class="stringliteral">"password"</span>];
00017 <a class="code" href="auth_8php.html#a2">$passphrase</a>=$_POST[<span class="stringliteral">"passphrase"</span>];
00018 
00019 <span class="comment">//escapeshellcmd() escapes any characters in a string that might </span>
00020 <span class="comment">//be used to trick a shell command into executing arbitrary commands.</span>
<a name="l00021"></a><a class="code" href="auth_8php.html#a0">00021</a> <a class="code" href="auth_8php.html#a0">$username</a>= escapeshellcmd($username);
<a name="l00022"></a><a class="code" href="auth_8php.html#a1">00022</a> <a class="code" href="auth_8php.html#a1">$password</a>= escapeshellcmd($password);
<a name="l00023"></a><a class="code" href="auth_8php.html#a2">00023</a> <a class="code" href="auth_8php.html#a2">$passphrase</a>= escapeshellcmd($passphrase);
00024 
00025 echo <span class="stringliteral">"EOOOO $username $password $passphrase&lt;br&gt;"</span>;
00026 
00027 <span class="comment">//The fields are required</span>
00028 <span class="keywordflow">if</span> ( (<a class="code" href="auth_8php.html#a0">$username</a>==<span class="stringliteral">""</span>) || (<a class="code" href="auth_8php.html#a1">$password</a>==<span class="stringliteral">""</span>)|| (<a class="code" href="auth_8php.html#a2">$passphrase</a>==<span class="stringliteral">""</span>) ) 
00029 {
00030     <span class="comment">//required_fields();</span>
00031 }
00032 <span class="comment">/*</span>
00033 <span class="comment">//Zap everything past first nonword character</span>
00034 <span class="comment">$username = ltrim($username);</span>
00035 <span class="comment">$findme  = ' ';</span>
00036 <span class="comment">$pos = strpos($username, $findme);</span>
00037 <span class="comment"></span>
00038 <span class="comment">if ( is_numeric($pos) == true ) </span>
00039 <span class="comment">{</span>
00040 <span class="comment">        $username=substr($username, 0, $pos);</span>
00041 <span class="comment">} </span>
00042 <span class="comment">*/</span><span class="comment"></span>
00043 <span class="comment">//////////////////////////////</span>
00044 <span class="comment"></span>$descriptorspec = array(
00045                 0 =&gt; array(<span class="stringliteral">"pipe"</span>, <span class="stringliteral">"r"</span>),  <span class="comment">// stdin is a pipe that the child will read from</span>
00046                 1 =&gt; array(<span class="stringliteral">"pipe"</span>, <span class="stringliteral">"w"</span>),  <span class="comment">// stdout is a pipe that the child will write to</span>
00047                 2 =&gt; array(<span class="stringliteral">"file"</span>, <span class="stringliteral">"/tmp/error-output.txt"</span>, <span class="stringliteral">"a"</span>) <span class="comment">// stderr is a file to write to</span>
00048         );
00049         
00050         echo <span class="stringliteral">"OOOOOOOOO&lt;br&gt;"</span>;
<a name="l00051"></a><a class="code" href="auth_8php.html#a3">00051</a>         <a class="code" href="auth_8php.html#a3">$process</a> = proc_open(<span class="stringliteral">"bash"</span>, $descriptorspec, $pipes);
00052         
00053         fwrite($pipes[0], <span class="stringliteral">"whoami\n"</span>);
00054         fwrite($pipes[0], <span class="stringliteral">"pwd\n"</span>);
00055         fwrite($pipes[0], <span class="stringliteral">"echo cambiamos\n"</span>);
00056 
00057         
00058         fwrite($pipes[0], <span class="stringliteral">"sudo -u david ls -la /home/david\n"</span>);
00059         sleep(5);     
00060         fwrite($pipes[0], <span class="stringliteral">"\n"</span>);
00061         
00062         <span class="comment">// Required to close the 'child' process, otherwise 'proc_close' function hangs!!!</span>
00063         fwrite($pipes[0], <span class="stringliteral">"exit\n"</span>);
00064 
00065         fclose($pipes[0]);
00066 
00067         <span class="comment">// The output from the commands</span>
00068         <span class="comment">// Uncomment to debug the 'child' process!!!</span>
00069         
00070         <span class="keywordflow">while</span> (!feof($pipes[1]))
00071         {
00072                 echo fgets($pipes[1], 1024).<span class="stringliteral">"&lt;br /&gt;"</span>;
00073         }
00074         
00075         fclose($pipes[1]);
00076 
00077         <span class="comment">// It's important that you close any pipes before calling</span>
00078         <span class="comment">// proc_close in order to avoid a deadlock</span>
<a name="l00079"></a><a class="code" href="auth_8php.html#a4">00079</a>         <a class="code" href="auth_8php.html#a4">$return_value</a> = proc_close($process);
00080         
00081         echo <span class="stringliteral">"\ncommand returned $return_value\n"</span>;
00082 
<a name="l00083"></a><a class="code" href="auth_8php.html#a5">00083</a> function <a class="code" href="auth_8php.html#a5">required_fields</a>()
00084 {
00085    
00086     echo <span class="stringliteral">"&lt;h1&gt;Error. Username, password and passphrase are required.&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span>;
00087     <span class="comment">//exit;</span>
00088 }
00089 
00090 
00091 ?&gt;
00092 &lt;center&gt;
00093 &lt;table&gt;
00094 &lt;tr&gt;
00095         &lt;td align=center&gt;&lt;img src=<span class="stringliteral">"../interface/egee.jpg"</span> alt=<span class="stringliteral">"[EGEE]"</span>&gt;&lt;/a&gt;
00096         &lt;/td&gt;
00097 &lt;/tr&gt;
00098 &lt;/table&gt;
00099 &lt;p&gt;
00100         &lt;a href=<span class="stringliteral">"http://validator.w3.org/check?uri=referer"</span>&gt;
00101         &lt;img border=<span class="stringliteral">"0"</span> src=<span class="stringliteral">"http://www.w3.org/Icons/valid-html401"</span>alt=<span class="stringliteral">"Valid HTML 4.01!"</span> height=<span class="stringliteral">"31"</span> width=<span class="stringliteral">"88"</span>&gt;&lt;/a&gt;
00102 &lt;/p&gt;
00103 &lt;/center&gt;
00104 
00105 &lt;/body&gt;
00106 &lt;/html&gt;
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Dec 2 16:13:58 2004 for GridGRAMM by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
