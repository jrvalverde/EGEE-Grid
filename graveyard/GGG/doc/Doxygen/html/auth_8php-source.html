<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GridGRAMM: auth.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>auth.php</h1><a href="auth_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 &lt;!DOCTYPE HTML PUBLIC <span class="stringliteral">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="stringliteral">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;
00002 
00003 &lt;html&gt;
00004 &lt;head&gt;
00005         &lt;meta http-equiv=<span class="stringliteral">"Content-Type"</span> content=<span class="stringliteral">"text/html; charset=UTF-8"</span> &gt;
00006         &lt;title&gt;Results&lt;/title&gt;
00007 &lt;/head&gt;
00008 
00009 &lt;?
00010 <a class="code" href="auth_8php.html#a0">$username</a>=$_POST[<span class="stringliteral">"username"</span>];
00011 <a class="code" href="auth_8php.html#a1">$password</a>=$_POST[<span class="stringliteral">"password"</span>];
00012 <a class="code" href="auth_8php.html#a2">$life</a>=$_POST[<span class="stringliteral">"life"</span>];
00013 
00014 <span class="comment">//escapeshellcmd() escapes any characters in a string that might </span>
00015 <span class="comment">//be used to trick a shell command into executing arbitrary commands.</span>
00016 <a class="code" href="auth_8php.html#a0">$username</a>= escapeshellcmd($username);
<a name="l00017"></a><a class="code" href="auth_8php.html#a1">00017</a> <a class="code" href="auth_8php.html#a1">$password</a>= escapeshellcmd($password);
<a name="l00018"></a><a class="code" href="auth_8php.html#a2">00018</a> <a class="code" href="auth_8php.html#a2">$life</a>= escapeshellcmd($life);
00019 
00020 <span class="comment">//MyProxy installation program</span>
<a name="l00021"></a><a class="code" href="auth_8php.html#a3">00021</a> <a class="code" href="auth_8php.html#a3">$program</a>  = <span class="stringliteral">"/opt/globus/bin/myproxy/bin/myproxy-get-delegation"</span>;
00022  
00023 <span class="comment">//Outfile</span>
<a name="l00024"></a><a class="code" href="auth_8php.html#a4">00024</a> <a class="code" href="auth_8php.html#a4">$outfile</a> = <span class="stringliteral">"/data/www/EMBnet/tmp/grid/$username.cred"</span>;
00025 
00026 <span class="comment">//Program arguments</span>
<a name="l00027"></a><a class="code" href="auth_8php.html#a5">00027</a> <a class="code" href="auth_8php.html#a5">$args</a>     = <span class="stringliteral">"-s localhost -l $username -t $life -o $outfile"</span>;
00028 
00029 echo <span class="stringliteral">"EOOOO $username $password $life"</span>;
00030 
00031 <span class="comment">//The fields are required</span>
00032 <span class="keywordflow">if</span> ((<a class="code" href="auth_8php.html#a0">$username</a>==<span class="stringliteral">""</span>) || (<a class="code" href="auth_8php.html#a1">$password</a>==<span class="stringliteral">""</span>) || (<a class="code" href="auth_8php.html#a2">$life</a>==<span class="stringliteral">""</span>)) 
00033 {
00034     required_fields();
00035 }
00036 
00037 <span class="comment">//Zap everything past first nonword character</span>
<a name="l00038"></a><a class="code" href="auth_8php.html#a0">00038</a> <a class="code" href="auth_8php.html#a0">$username</a> = ltrim($username);
<a name="l00039"></a><a class="code" href="auth_8php.html#a6">00039</a> <a class="code" href="auth_8php.html#a6">$findme</a>  = <span class="charliteral">' '</span>;
<a name="l00040"></a><a class="code" href="auth_8php.html#a7">00040</a> <a class="code" href="auth_8php.html#a7">$pos</a> = strpos($username, $findme);
00041 <span class="keywordflow">if</span> (is_numeric($pos) == <span class="keyword">true</span>) 
00042 {
00043         <a class="code" href="auth_8php.html#a0">$username</a>=substr($username, 0, $pos);
00044         
00045 } 
00046 
00047 <span class="comment">//We check the password length</span>
<a name="l00048"></a><a class="code" href="auth_8php.html#a8">00048</a> <a class="code" href="auth_8php.html#a8">$len</a> = strlen($password);
00049 <span class="keywordflow">if</span> (($len &lt; 5) || ($len &gt; 10)) 
00050 {
00051     passwordtoolong();
00052 }
00053 
00054 <span class="keywordflow">if</span> (is_numeric($lifetime) == <span class="keyword">false</span>) 
00055 {
00056   invalidlifetime();
00057 }
00058 
00059 function required_fields
00060 {
00061    
00062     echo <span class="stringliteral">"&lt;h1&gt;Error. All fields are required.&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span>;
00063     <a class="code" href="results_8php.html#a1">exit</a>;
00064 }
00065 
00066 function passwordtoolong
00067 {
00068    
00069     echo <span class="stringliteral">"&lt;h1&gt;The password must be between 5 and 10 characters.&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span>;
00070     <a class="code" href="results_8php.html#a1">exit</a>;
00071 }
00072 
00073 <span class="comment">/*</span>
00074 <span class="comment">Perl Translation!!!</span>
00075 <span class="comment"></span>
00076 <span class="comment"># use expect to run the command</span>
00077 <span class="comment">my $cmd_filehandle = Expect-&gt;spawn("$program $args");</span>
00078 <span class="comment"></span>
00079 <span class="comment"># this looks for the string "Pass Phrase:" for 20 seconds</span>
00080 <span class="comment"># and failing that, does the "error" subroutine.</span>
00081 <span class="comment">unless ($cmd_filehandle-&gt;expect(20, "Pass Phrase:")) </span>
00082 <span class="comment">{</span>
00083 <span class="comment">  printerror();</span>
00084 <span class="comment">}</span>
00085 <span class="comment"></span>
00086 <span class="comment">print $cmd_filehandle "$password\n";</span>
00087 <span class="comment"></span>
00088 <span class="comment"># gather the output into the array</span>
00089 <span class="comment">@output = &lt;$cmd_filehandle&gt;;</span>
00090 <span class="comment"></span>
00091 <span class="comment"># close the filehandle to the command</span>
00092 <span class="comment">$cmd_filehandle-&gt;soft_close();</span>
00093 <span class="comment"></span>
00094 <span class="comment"># now you have an array called @outputmsg which has the rest of the output... </span>
00095 <span class="comment"># get rid of output[0], since it contains the password</span>
00096 <span class="comment"></span>
00097 <span class="comment">$outputmsg = join(" ", $output[1]);</span>
00098 <span class="comment">if ($cmd_filehandle-&gt;exitstatus() != 0) {</span>
00099 <span class="comment">    $outputmsg =~ s/(.*):\s//;</span>
00100 <span class="comment">    &amp;printerror($outputmsg);</span>
00101 <span class="comment">} else {</span>
00102 <span class="comment">    &amp;printsuccess;</span>
00103 <span class="comment">}</span>
00104 <span class="comment"></span>
00105 <span class="comment"></span>
00106 <span class="comment"></span>
00107 <span class="comment">sub printerror</span>
00108 <span class="comment">{</span>
00109 <span class="comment">    my $errmsg = $_[0];</span>
00110 <span class="comment">    print header;</span>
00111 <span class="comment">    print "&lt;BODY BGCOLOR=#efefef&gt;"; </span>
00112 <span class="comment">    print "&lt;TITLE&gt;Error!&lt;/TITLE&gt;";</span>
00113 <span class="comment">    print "&lt;H1&gt;&lt;FONT FACE=Arial COLOR=Red&gt;&lt;STRONG&gt;";</span>
00114 <span class="comment">    print "Error executing myproxy-get-delegation!\n";</span>
00115 <span class="comment">    print "&lt;/STRONG&gt;&lt;/FONT&gt;&lt;/H1&gt;";</span>
00116 <span class="comment">    print "$errmsg";</span>
00117 <span class="comment">    exit;</span>
00118 <span class="comment">}</span>
00119 <span class="comment"></span>
00120 <span class="comment">sub printsuccess</span>
00121 <span class="comment">{</span>
00122 <span class="comment">    print header;</span>
00123 <span class="comment">    print "&lt;BODY BGCOLOR=#efefef&gt;"; </span>
00124 <span class="comment">    print  "&lt;TITLE&gt;Error!&lt;/TITLE&gt;";</span>
00125 <span class="comment">    print "&lt;H1&gt;&lt;FONT FACE=Arial COLOR=Blue&gt;&lt;STRONG&gt;";</span>
00126 <span class="comment">    print "Received a delegated proxy for $username good for $lifetime hours.";</span>
00127 <span class="comment">    print "&lt;/STRONG&gt;&lt;/FONT&gt;&lt;/H1&gt;";</span>
00128 <span class="comment">    exit;</span>
00129 <span class="comment">}</span>
00130 <span class="comment"></span>
00131 <span class="comment">*/</span>      
00132 ?&gt;
00133 &lt;center&gt;
00134 &lt;table&gt;
00135 &lt;tr&gt;
00136         &lt;td align=center&gt;&lt;img src=<span class="stringliteral">"../interface/egee.jpg"</span> alt=<span class="stringliteral">"[EGEE]"</span>&gt;&lt;/a&gt;
00137         &lt;/td&gt;
00138 &lt;/tr&gt;
00139 &lt;/table&gt;
00140 &lt;p&gt;
00141         &lt;a href=<span class="stringliteral">"http://validator.w3.org/check?uri=referer"</span>&gt;
00142         &lt;img border=<span class="stringliteral">"0"</span> src=<span class="stringliteral">"http://www.w3.org/Icons/valid-html401"</span>alt=<span class="stringliteral">"Valid HTML 4.01!"</span> height=<span class="stringliteral">"31"</span> width=<span class="stringliteral">"88"</span>&gt;&lt;/a&gt;
00143 &lt;/p&gt;
00144 &lt;/center&gt;
00145 
00146 &lt;/body&gt;
00147 &lt;/html&gt;
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Nov 17 12:24:37 2004 for GridGRAMM by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
