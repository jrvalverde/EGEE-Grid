\section{functions.php File Reference}
\label{functions_8php}\index{functions.php@{functions.php}}
\subsection*{Namespaces}
\begin{CompactItemize}
\item 
namespace {\bf Grid\-GRAMM}
\end{CompactItemize}
\subsection*{Functions}
\begin{CompactItemize}
\item 
{\bf open\_\-connection} (\$server, \$grid\_\-path, \$process, \$descriptorspec, \$pipes)
\begin{CompactList}\small\item\em open a connection to the Grid UI server \item\end{CompactList}\item 
{\bf close\_\-connection} (\$process, \$descriptorspec, \$pipes)
\begin{CompactList}\small\item\em Close the connection with the remote Grid access point (UI node). \item\end{CompactList}\item 
{\bf install\_\-gramm} (\$grid\_\-path, \$random\_\-value)
\begin{CompactList}\small\item\em Install the program and scripts needed to run it on a suitable place. \item\end{CompactList}\item 
{\bf enter\_\-grid} (\$pipes, \$grid\_\-pass)
\begin{CompactList}\small\item\em Start the Grid services. \item\end{CompactList}\item 
{\bf create\_\-working\_\-directory} (\$grid\_\-path)
\begin{CompactList}\small\item\em Create working directory. \item\end{CompactList}\item 
{\bf job\_\-identifier} ()
\begin{CompactList}\small\item\em Get job identifier. \item\end{CompactList}\item 
{\bf check\_\-status} ()
\begin{CompactList}\small\item\em Check job status. \item\end{CompactList}\item 
{\bf upload\_\-user\_\-data} (\$grid\_\-path, \$random\_\-value)
\begin{CompactList}\small\item\em Upload user data. \item\end{CompactList}\item 
{\bf create\_\-gr\_\-files} (\$grid\_\-path, \$random\_\-value, \$resolution)
\begin{CompactList}\small\item\em Create configuration files needed to run GRAMM. \item\end{CompactList}\item 
{\bf create\_\-jdl\_\-file} (\$grid\_\-path, \$random\_\-value)
\begin{CompactList}\small\item\em Create JDL description of the job to be submitted to the Grid. \item\end{CompactList}\item 
{\bf unpack\_\-results} ()
\begin{CompactList}\small\item\em Extract results gathered from the Grid. \item\end{CompactList}\item 
{\bf show\_\-results} ()
\begin{CompactList}\small\item\em Show the results to the user. \item\end{CompactList}\end{CompactItemize}


\subsection{Function Documentation}
\index{functions.php@{functions.php}!check_status@{check\_\-status}}
\index{check_status@{check\_\-status}!functions.php@{functions.php}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}check\_\-status ()}\label{functions_8php_a6}


Check job status. 



Definition at line 241 of file functions.php.\index{functions.php@{functions.php}!close_connection@{close\_\-connection}}
\index{close_connection@{close\_\-connection}!functions.php@{functions.php}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}close\_\-connection (\$ {\em process}, \$ {\em descriptorspec}, \$ {\em pipes})}\label{functions_8php_a1}


Close the connection with the remote Grid access point (UI node). 

What we are going to do is to close the communication pipes and kill the child processes that actually handles communication with the remote Grid UI host (ssh).

\begin{Desc}
\item[Note:]CLOSE\_\-CONNECTION IS USEFUL TO DEBUG!!!\end{Desc}
\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em \$process}]\item[{\em \$descriptorspec}]\item[{\em \$pipes}]\end{description}
\end{Desc}


Definition at line 100 of file functions.php.

References \$return\_\-value.\index{functions.php@{functions.php}!create_gr_files@{create\_\-gr\_\-files}}
\index{create_gr_files@{create\_\-gr\_\-files}!functions.php@{functions.php}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}create\_\-gr\_\-files (\$ {\em grid\_\-path}, \$ {\em random\_\-value}, \$ {\em resolution})}\label{functions_8php_a8}


Create configuration files needed to run GRAMM. 



Definition at line 314 of file functions.php.

References \$resolution.\index{functions.php@{functions.php}!create_jdl_file@{create\_\-jdl\_\-file}}
\index{create_jdl_file@{create\_\-jdl\_\-file}!functions.php@{functions.php}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}create\_\-jdl\_\-file (\$ {\em grid\_\-path}, \$ {\em random\_\-value})}\label{functions_8php_a9}


Create JDL description of the job to be submitted to the Grid. 



Definition at line 379 of file functions.php.\index{functions.php@{functions.php}!create_working_directory@{create\_\-working\_\-directory}}
\index{create_working_directory@{create\_\-working\_\-directory}!functions.php@{functions.php}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}create\_\-working\_\-directory (\$ {\em grid\_\-path})}\label{functions_8php_a4}


Create working directory. 



Definition at line 197 of file functions.php.

References exit.\index{functions.php@{functions.php}!enter_grid@{enter\_\-grid}}
\index{enter_grid@{enter\_\-grid}!functions.php@{functions.php}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}enter\_\-grid (\$ {\em pipes}, \$ {\em grid\_\-pass})}\label{functions_8php_a3}


Start the Grid services. 



Definition at line 184 of file functions.php.\index{functions.php@{functions.php}!install_gramm@{install\_\-gramm}}
\index{install_gramm@{install\_\-gramm}!functions.php@{functions.php}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}install\_\-gramm (\$ {\em grid\_\-path}, \$ {\em random\_\-value})}\label{functions_8php_a2}


Install the program and scripts needed to run it on a suitable place. 

This function installs the docking program GRAMM and the scripts needed to run it on a suitable local directory.

Since we may potentially be called many times in a short period we need a way to make sure their jobs don't clash with one another, most specially, that they don't overwrite each others' workspace.

For this reason, we use a separate working directory for each request. This function will install GRAMM on the specified working directory.

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em grid\_\-path}]local directory devoted to Grid work \item[{\em random\_\-value}]a random value to generate a unique name for the working directory. \end{description}
\end{Desc}


Definition at line 143 of file functions.php.

References exit.\index{functions.php@{functions.php}!job_identifier@{job\_\-identifier}}
\index{job_identifier@{job\_\-identifier}!functions.php@{functions.php}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}job\_\-identifier ()}\label{functions_8php_a5}


Get job identifier. 



Definition at line 226 of file functions.php.\index{functions.php@{functions.php}!open_connection@{open\_\-connection}}
\index{open_connection@{open\_\-connection}!functions.php@{functions.php}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}open\_\-connection (\$ {\em server}, \$ {\em grid\_\-path}, \$ {\em process}, \$ {\em descriptorspec}, \$ {\em pipes})}\label{functions_8php_a0}


open a connection to the Grid UI server 

The Grid User Interface server is the entry point to the Grid for users and user applications. This is where jobs are launched from.

{\bf Grid\-GRAMM}{\rm (p.\,\pageref{namespaceGridGRAMM})} has been designed to be able to be installed in any host, independent of whether it is an UI or not. Thus, to be able to submit jobs to the Grid, the server hosting {\bf Grid\-GRAMM}{\rm (p.\,\pageref{namespaceGridGRAMM})} must connect to a Grid UI host to do the work.

This routine opens a connection to a Grid UI host using a predefined username (i.e. all jobs will be run under said username). To allow the caller to communicate with the remote end, it creates two pipes, one for input and one for output, and redirect error messages to a file.

These pipes lead to a child process that actually manages the communication. Using a child process has several advantages: it simplifies the communication process by offloading the comm. logic to a separate, convenience tool, and by being able to use SSH as the child, we can increase security taking advantage of its encryption capabilities.

The panorama therefore will look like this:

HTML front-end --$>$ {\bf processor.php}{\rm (p.\,\pageref{processor_8php})} $<$--$>$ SSH $<$--$>$ remote host $<$--$>$ Grid

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em server}]A {\tt username@remove.grid.ui.host} pair to use a command processor \item[{\em grid\_\-path}]Path to working directory in the local machine \item[{\em process}]A handle to the child process that manages communication with the Grid access point \item[{\em descriptorspec}]\item[{\em pipes}]An array of file descriptors to be used to communicate withe the Grid UI through the child process. \end{description}
\end{Desc}


Definition at line 53 of file functions.php.

References \$descriptorspec, \$process, and exit.\index{functions.php@{functions.php}!show_results@{show\_\-results}}
\index{show_results@{show\_\-results}!functions.php@{functions.php}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}show\_\-results ()}\label{functions_8php_a11}


Show the results to the user. 



Definition at line 425 of file functions.php.\index{functions.php@{functions.php}!unpack_results@{unpack\_\-results}}
\index{unpack_results@{unpack\_\-results}!functions.php@{functions.php}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}unpack\_\-results ()}\label{functions_8php_a10}


Extract results gathered from the Grid. 



Definition at line 402 of file functions.php.\index{functions.php@{functions.php}!upload_user_data@{upload\_\-user\_\-data}}
\index{upload_user_data@{upload\_\-user\_\-data}!functions.php@{functions.php}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}upload\_\-user\_\-data (\$ {\em grid\_\-path}, \$ {\em random\_\-value})}\label{functions_8php_a7}


Upload user data. 



Definition at line 259 of file functions.php.

References exit.