<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>php::Grid: grid_test.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>grid_test.php</h1><a href="grid__test_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 &lt;?<span class="comment"></span>
00002 <span class="comment">/**</span>
00003 <span class="comment"> *      test routines</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * To test on the command line, use</span>
00006 <span class="comment"> *  ssh -x -T localhost "(cd `pwd` ; php grid_test.php)"</span>
00007 <span class="comment"> */</span>
00008 require_once './grid_config.php';
00009 require_once './ssh.php';
00010 require_once './grid.php';
00011 
00012 <span class="preprocessor">#$user="user";</span>
00013 <span class="preprocessor"></span><span class="preprocessor">#$host="host";</span>
00014 <span class="preprocessor"></span><span class="preprocessor">#$passwd="pwd";</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#$passphrase="psp";</span>
00016 <span class="preprocessor"></span><span class="comment"></span>
00017 <span class="comment">/**</span>
00018 <span class="comment"> * test Grid::initialize()/destroy()</span>
00019 <span class="comment"> *</span>
00020 <span class="comment"> * Grid::initialize() allows us to identify ourselves to the Grid.</span>
00021 <span class="comment"> * Identification must be made from a UI node, hence we need to connect</span>
00022 <span class="comment"> * first to a UI node.</span>
00023 <span class="comment"> *</span>
00024 <span class="comment"> */</span>
<a name="l00025"></a><a class="code" href="grid__test_8php.html#a2">00025</a> function <a class="code" href="grid__test_8php.html#a2">test_grid_init</a>()
00026 {
00027     global $user, $host, $passwd, $passphrase;
00028     
00029     echo <span class="stringliteral">"----------------------------------------------\n"</span>;
00030     echo <span class="stringliteral">"            Testing Grid::init()\n"</span>;
00031     echo <span class="stringliteral">"----------------------------------------------\n"</span>;
00032 
00033     $eg = <span class="keyword">new</span> <a class="code" href="classGrid.html">Grid</a>;
00034     <span class="keywordflow">if</span> ($eg == FALSE) {
00035         echo <span class="stringliteral">"error: couldn't create grid object\n"</span>;
00036         <span class="keywordflow">return</span>;
00037     }
00038     $eg-&gt;set_user($user);
00039     $eg-&gt;set_host($host);
00040     $eg-&gt;set_password($passwd);
00041     $eg-&gt;set_passphrase($passphrase);
00042     $eg-&gt;set_work_dir(<span class="stringliteral">"/tmp/grid/debug"</span>);
00043     $eg-&gt;set_error_log(<span class="stringliteral">"/tmp/grid/debug/connection.err"</span>);
00044     <span class="keywordflow">if</span> (!$eg-&gt;initialize())
00045         echo <span class="stringliteral">"error: couldn't init the grid\n"</span>;
00046     <span class="keywordflow">else</span>
00047         echo <span class="stringliteral">"OK\n"</span>;
00048     $eg-&gt;destroy();
00049     $eg-&gt;sx-&gt;destruct();    <span class="comment">// shouldn't be needed. REVIEW SExec.</span>
00050 }
00051 
<a name="l00052"></a><a class="code" href="grid__test_8php.html#a3">00052</a> function <a class="code" href="grid__test_8php.html#a3">test_job_submit</a>()
00053 {
00054     global $user, $host, $passwd, $passphrase;
00055     
00056     echo <span class="stringliteral">"----------------------------------------------\n"</span>;
00057     echo <span class="stringliteral">"         Testing Grid::job_submit()\n"</span>;
00058     echo <span class="stringliteral">"----------------------------------------------\n"</span>;
00059 
00060     $eg = <span class="keyword">new</span> <a class="code" href="classGrid.html">Grid</a>;
00061     $eg-&gt;set_user($user);
00062     $eg-&gt;set_host($host);
00063     $eg-&gt;set_password($passwd);
00064     $eg-&gt;set_passphrase($passphrase);
00065     $eg-&gt;set_work_dir(<span class="stringliteral">"/tmp/grid/debug"</span>);
00066     $eg-&gt;set_error_log(<span class="stringliteral">"/tmp/grid/debug/connection.err"</span>);
00067     echo <span class="stringliteral">"initializing grid... "</span>;
00068     <span class="keywordflow">if</span> (!$eg-&gt;initialize())
00069         echo <span class="stringliteral">"error: couldn't init the grid\n"</span>;
00070     <span class="keywordflow">else</span>
00071         echo <span class="stringliteral">"OK\n"</span>;
00072     echo <span class="stringliteral">"Submitting tst-job... "</span>;
00073     <span class="keywordflow">if</span> (! $eg-&gt;job_submit(<span class="stringliteral">"tst-job"</span>, $out))
00074         echo <span class="stringliteral">"error: coudn't start the job\n"</span>;
00075     <span class="keywordflow">else</span> 
00076         echo <span class="stringliteral">"OK\n"</span>;
00077     print_r($out);
00078 <span class="preprocessor">    #$eg-&gt;destroy();</span>
00079 <span class="preprocessor"></span>    $eg-&gt;sx-&gt;destruct();    <span class="comment">// shouldn't be needed. REVIEW SExec.</span>
00080 }
00081 
<a name="l00082"></a><a class="code" href="grid__test_8php.html#a4">00082</a> function <a class="code" href="grid__test_8php.html#a4">test_job_get_id</a>()
00083 {
00084     global $user, $host, $passwd, $passphrase;
00085     
00086     echo <span class="stringliteral">"----------------------------------------------\n"</span>;
00087     echo <span class="stringliteral">"          Testing Grid::job_get_id()\n"</span>;
00088     echo <span class="stringliteral">"----------------------------------------------\n"</span>;
00089 
00090     $eg = <span class="keyword">new</span> <a class="code" href="classGrid.html">Grid</a>;
00091     $eg-&gt;set_user($user);
00092     $eg-&gt;set_host($host);
00093     $eg-&gt;set_password($passwd);
00094     $eg-&gt;set_passphrase($passphrase);
00095     $eg-&gt;set_work_dir(<span class="stringliteral">"/tmp/grid/debug"</span>);
00096     $eg-&gt;set_error_log(<span class="stringliteral">"/tmp/grid/debug/connection.err"</span>);
00097     echo <span class="stringliteral">"initializing grid... "</span>;
00098     <span class="keywordflow">if</span> (!$eg-&gt;initialize())
00099         echo <span class="stringliteral">"error: couldn't init the grid\n"</span>;
00100     <span class="keywordflow">else</span>
00101         echo <span class="stringliteral">"OK\n"</span>;
00102     echo <span class="stringliteral">"Submitting tst-job... "</span>;
00103     <span class="keywordflow">if</span> (! $eg-&gt;job_submit(<span class="stringliteral">"tst-job"</span>, $out))
00104         echo <span class="stringliteral">"error: coudn't start the job\n"</span>;
00105     <span class="keywordflow">else</span> 
00106         echo <span class="stringliteral">"OK\n"</span>;
00107     print_r($out);
00108     print_r($eg-&gt;job_get_id(<span class="stringliteral">"tst-job"</span>));
00109     $eg-&gt;sx-&gt;destruct();    <span class="comment">// shouldn't be needed. REVIEW SExec.</span>
00110 }
00111 
<a name="l00112"></a><a class="code" href="grid__test_8php.html#a5">00112</a> function <a class="code" href="grid__test_8php.html#a5">test_job_status</a>()
00113 {
00114     global $user, $host, $passwd, $passphrase;
00115     
00116     echo <span class="stringliteral">"----------------------------------------------\n"</span>;
00117     echo <span class="stringliteral">"         Testing Grid::job_status()\n"</span>;
00118     echo <span class="stringliteral">"----------------------------------------------\n"</span>;
00119 
00120     $eg = <span class="keyword">new</span> <a class="code" href="classGrid.html">Grid</a>;
00121     $eg-&gt;set_user($user);
00122     $eg-&gt;set_host($host);
00123     $eg-&gt;set_password($passwd);
00124     $eg-&gt;set_passphrase($passphrase);
00125     $eg-&gt;set_work_dir(<span class="stringliteral">"/tmp/grid/debug"</span>);
00126     $eg-&gt;set_error_log(<span class="stringliteral">"/tmp/grid/debug/connection.err"</span>);
00127     echo <span class="stringliteral">"initializing grid... "</span>;
00128     <span class="keywordflow">if</span> (!$eg-&gt;initialize())
00129         echo <span class="stringliteral">"error: couldn't init the grid\n"</span>;
00130     <span class="keywordflow">else</span>
00131         echo <span class="stringliteral">"OK\n"</span>;
00132     echo <span class="stringliteral">"Submitting tst-job... "</span>;
00133     <span class="keywordflow">if</span> (! $eg-&gt;job_submit(<span class="stringliteral">"tst-job"</span>, $out))
00134         echo <span class="stringliteral">"error: coudn't start the job\n"</span>;
00135     <span class="keywordflow">else</span> 
00136         echo <span class="stringliteral">"OK\n"</span>;
00137     print_r($out);
00138     echo <span class="stringliteral">"\nGetting job ID... \n"</span>;
00139     print_r($eg-&gt;job_get_id(<span class="stringliteral">"tst-job"</span>));
00140     echo <span class="stringliteral">"\nGetting job status... \n"</span>;
00141     print_r($eg-&gt;job_status(<span class="stringliteral">"tst-job"</span>, $out));
00142     $eg-&gt;sx-&gt;destruct();    <span class="comment">// shouldn't be needed. REVIEW SExec.</span>
00143 }
00144 
<a name="l00145"></a><a class="code" href="grid__test_8php.html#a6">00145</a> function <a class="code" href="grid__test_8php.html#a6">test_job_get_output</a>()
00146 {
00147     global $user, $host, $passwd, $passphrase;
00148     
00149     echo <span class="stringliteral">"----------------------------------------------\n"</span>;
00150     echo <span class="stringliteral">"         Testing Grid::job_get_output()\n"</span>;
00151     echo <span class="stringliteral">"----------------------------------------------\n"</span>;
00152 
00153     $eg = <span class="keyword">new</span> <a class="code" href="classGrid.html">Grid</a>;
00154     $eg-&gt;set_user($user);
00155     $eg-&gt;set_host($host);
00156     $eg-&gt;set_password($passwd);
00157     $eg-&gt;set_passphrase($passphrase);
00158     $eg-&gt;set_work_dir(<span class="stringliteral">"/tmp/grid/debug"</span>);
00159     $eg-&gt;set_error_log(<span class="stringliteral">"/tmp/grid/debug/connection.err"</span>);
00160     echo <span class="stringliteral">"initializing grid... "</span>;
00161     <span class="keywordflow">if</span> (!$eg-&gt;initialize())
00162         echo <span class="stringliteral">"error: couldn't init the grid\n"</span>;
00163     <span class="keywordflow">else</span>
00164         echo <span class="stringliteral">"OK\n"</span>;
00165     echo <span class="stringliteral">"Submitting tst-job... "</span>;
00166     <span class="keywordflow">if</span> (! $eg-&gt;job_submit(<span class="stringliteral">"tst-job"</span>, $out))
00167        echo <span class="stringliteral">"error: coudn't start the job\n"</span>;
00168     <span class="keywordflow">else</span> 
00169        echo <span class="stringliteral">"OK\n"</span>;
00170     print_r($out);
00171     echo <span class="stringliteral">"\nGetting job ID... \n"</span>;
00172     print_r($eg-&gt;job_get_id(<span class="stringliteral">"tst-job"</span>));
00173     echo <span class="stringliteral">"\nGetting job status... \n"</span>;
00174     print_r($eg-&gt;job_status(<span class="stringliteral">"tst-job"</span>, $out));
00175     echo <span class="stringliteral">"\nWaiting 20s for job\n"</span>;
00176     sleep(20);
00177     echo <span class="stringliteral">"\nGetting job output... "</span>;
00178     <span class="keywordflow">if</span> (! $eg-&gt;job_get_output(<span class="stringliteral">"tst-job"</span>, $out))
00179         echo <span class="stringliteral">"error: couldn't get job output\n"</span>;
00180     <span class="keywordflow">else</span>
00181         echo <span class="stringliteral">"OK\n"</span>;
00182     print_r($out);
00183     $eg-&gt;sx-&gt;destruct();    <span class="comment">// shouldn't be needed. REVIEW SExec.</span>
00184 }
00185 
<a name="l00186"></a><a class="code" href="grid__test_8php.html#a7">00186</a> function <a class="code" href="grid__test_8php.html#a7">test_sessions</a>()
00187 {
00188     global $user, $host, $passwd, $passphrase;
00189     
00190     echo <span class="stringliteral">"----------------------------------------------\n"</span>;
00191     echo <span class="stringliteral">"         Testing Grid::job_get_output()\n"</span>;
00192     echo <span class="stringliteral">"----------------------------------------------\n"</span>;
00193 
00194     $eg = <span class="keyword">new</span> <a class="code" href="classGrid.html">Grid</a>;
00195     $eg-&gt;set_user($user);
00196     $eg-&gt;set_host($host);
00197     $eg-&gt;set_password($passwd);
00198     $eg-&gt;set_passphrase($passphrase);
00199     $eg-&gt;set_work_dir(<span class="stringliteral">"/tmp/grid/debug"</span>);
00200     $eg-&gt;set_error_log(<span class="stringliteral">"/tmp/grid/debug/connection.err"</span>);
00201     echo <span class="stringliteral">"initializing grid... "</span>;
00202     <span class="keywordflow">if</span> (!$eg-&gt;initialize())
00203         echo <span class="stringliteral">"error: couldn't init the grid\n"</span>;
00204     <span class="keywordflow">else</span>
00205         echo <span class="stringliteral">"OK\n"</span>;
00206     echo <span class="stringliteral">"Submitting tst-job to default session...\n"</span>;
00207     $out = array(<span class="stringliteral">""</span>);
00208     <span class="keywordflow">if</span> (! $eg-&gt;job_submit(<span class="stringliteral">"tst-job"</span>, $out))
00209        echo <span class="stringliteral">"error: coudn't start the job\n"</span>;
00210     <span class="keywordflow">else</span> 
00211        echo <span class="stringliteral">"OK\n"</span>;
00212     print_r($out);
00213     echo <span class="stringliteral">"cancelling job\n"</span>;
00214     <span class="keywordflow">if</span> (! $eg-&gt;job_cancel(<span class="stringliteral">"tst-job"</span>, $out)) 
00215         echo <span class="stringliteral">"FAILED:\n"</span>;
00216     <span class="keywordflow">else</span> 
00217         echo <span class="stringliteral">"OK:\n"</span>;
00218     print_r($out);
00219     $eg-&gt;session_list_all();
00220     echo <span class="stringliteral">"Submitting tst-job to a new session...\n"</span>;
00221     $sess = $eg-&gt;new_session();
00222     echo <span class="stringliteral">"sess = "</span>; print_r($sess); echo <span class="stringliteral">"\n"</span>;
00223     <span class="keywordflow">if</span> ($sess != FALSE) {
00224         $out = array(<span class="stringliteral">""</span>);
00225         <span class="keywordflow">if</span> (! $eg-&gt;job_submit(<span class="stringliteral">"tst-job"</span>, $out, $sess))
00226            echo <span class="stringliteral">"error: coudn't start the job\n"</span>;
00227         <span class="keywordflow">else</span> {
00228            echo <span class="stringliteral">"OK\n"</span>;
00229             print_r($out);
00230             echo <span class="stringliteral">"\nGetting job ID... \n"</span>;
00231             print_r($eg-&gt;job_get_id(<span class="stringliteral">"tst-job"</span>, $sess));
00232             echo <span class="stringliteral">"\nGetting job status... \n"</span>;
00233             print_r($eg-&gt;job_status(<span class="stringliteral">"tst-job"</span>, $out, $sess));
00234             echo <span class="stringliteral">"\nWaiting 20s for job\n"</span>;
00235             sleep(20);
00236             echo <span class="stringliteral">"\nGetting job output... \n"</span>;
00237             <span class="keywordflow">if</span> (! $eg-&gt;job_get_output(<span class="stringliteral">"tst-job"</span>, $out, $sess))
00238                 echo <span class="stringliteral">"error: couldn't get job output\n"</span>;
00239             <span class="keywordflow">else</span>
00240                 echo <span class="stringliteral">"OK\n"</span>;
00241             print_r($out);
00242         }
00243         $eg-&gt;session_list_all();
00244         $eg-&gt;session_destroy($sess);
00245         
00246     }
00247     $eg-&gt;session_list_all();
00248     $eg-&gt;destruct();    <span class="comment">// shouldn't be needed. REVIEW</span>
00249 }
00250 
00251 <span class="preprocessor"># create test job as follows:</span>
00252 <span class="preprocessor"></span><span class="preprocessor">#----------------------------</span>
00253 <span class="preprocessor"></span><span class="preprocessor"># rm -rf tst-job</span>
00254 <span class="preprocessor"></span><span class="preprocessor"># mkdir tst-job</span>
00255 <span class="preprocessor"></span><span class="preprocessor"># cat &gt; tst-job/job.jdl&lt;&lt;END</span>
00256 <span class="preprocessor"></span><span class="preprocessor"># Type = "Job";</span>
00257 <span class="preprocessor"></span><span class="preprocessor"># JobType = "normal";</span>
00258 <span class="preprocessor"></span><span class="preprocessor"># VirtualOrganisation= "biomed";</span>
00259 <span class="preprocessor"></span><span class="preprocessor"># Executable = "/bin/hostname";</span>
00260 <span class="preprocessor"></span><span class="preprocessor"># StdOutput = "output.out";</span>
00261 <span class="preprocessor"></span><span class="preprocessor"># StdError = "error.err";</span>
00262 <span class="preprocessor"></span><span class="preprocessor"># OutputSandbox = {"error.err","output.out"};</span>
00263 <span class="preprocessor"></span><span class="preprocessor"># END</span>
00264 <span class="preprocessor"></span>
<a name="l00265"></a><a class="code" href="grid__test_8php.html#a0">00265</a> <a class="code" href="grid__test_8php.html#a0">$debug_grid</a> = TRUE;
<a name="l00266"></a><a class="code" href="grid__test_8php.html#a1">00266</a> <a class="code" href="grid__test_8php.html#a1">$debug_sexec</a>= TRUE;
00267 
00268 echo <span class="stringliteral">"&lt;html&gt;&lt;body&gt;\n"</span>;
00269 echo <span class="stringliteral">"&lt;PRE&gt;\n"</span>;
00270 
00271 <span class="keywordflow">if</span> (<a class="code" href="grid__test_8php.html#a0">$debug_grid</a>) {
00272 
00273     <a class="code" href="grid__test_8php.html#a2">test_grid_init</a>();           <span class="comment">// OK</span>
00274 <span class="preprocessor">    #test_job_submit();         // OK</span>
00275 <span class="preprocessor"></span><span class="preprocessor">    #test_job_get_id();         // OK</span>
00276 <span class="preprocessor"></span><span class="preprocessor">    #test_job_status();         // OK</span>
00277 <span class="preprocessor"></span><span class="preprocessor">    #test_job_get_output();             // OK</span>
00278 <span class="preprocessor"></span><span class="preprocessor">    #test_sessions();</span>
00279 <span class="preprocessor"></span>}
00280 
00281 echo <span class="stringliteral">"&lt;/PRE&gt;\n"</span>;
00282 echo <span class="stringliteral">"&lt;/body&gt;&lt;/html&gt;\n"</span>;
00283 ?&gt;
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jun 22 10:01:10 2006 for php::Grid by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
