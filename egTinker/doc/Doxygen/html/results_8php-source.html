<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>egTinker: results.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>results.php</h1><a href="results_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 &lt;!DOCTYPE HTML PUBLIC <span class="stringliteral">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="stringliteral">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;
00002 
00003 &lt;html&gt;
00004 &lt;head&gt;
00005         &lt;meta http-equiv=<span class="stringliteral">"Content-Type"</span> content=<span class="stringliteral">"text/html; charset=UTF-8"</span> &gt;
00006         &lt;meta http-equiv=<span class="stringliteral">"Refresh"</span> content=<span class="stringliteral">"15; url=./index.php"</span>&gt;
00007         &lt;title&gt;Results&lt;/title&gt;
00008 &lt;/head&gt;
00009 
00010 &lt;?<span class="comment"></span>
00011 <span class="comment">/**</span>
00012 <span class="comment"> * Display results</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *      Present the results to the user and allow him/her to browse,</span>
00015 <span class="comment"> * navigate and visualize them in a number of ways.</span>
00016 <span class="comment"> *</span>
00017 <span class="comment"> * @package GridGRAMM</span>
00018 <span class="comment"> * @author David Garcia Aristegui &lt;david@cnb.uam.es&gt;</span>
00019 <span class="comment"> * @copyright CSIC - GPL</span>
00020 <span class="comment"> * @version 1.0</span>
00021 <span class="comment"> */</span>
00022 <span class="comment"></span>
00023 <span class="comment">/**</span>
00024 <span class="comment"> * General utility functions</span>
00025 <span class="comment"> */</span>
00026 require(<span class="stringliteral">"./functions.php"</span>);
00027 <span class="comment"></span>
00028 <span class="comment">/**</span>
00029 <span class="comment"> * Current directory</span>
00030 <span class="comment"> *</span>
00031 <span class="comment"> * The 'child' process needs to know were is the working directory, to generate</span>
00032 <span class="comment"> * there the middleware output files</span>
00033 <span class="comment"> *</span>
00034 <span class="comment"> * @global string $current_directory</span>
00035 <span class="comment"> */</span>
<a name="l00036"></a><a class="code" href="results_8php.html#a0">00036</a> <a class="code" href="results_8php.html#a0">$current_directory</a>=getcwd();
00037 
00038 <span class="comment">// We check the job status...</span>
00039 <span class="comment">// This is a particular case, the job is done, we only show the results, otherwise we have to connect...</span>
00040 
00041 <span class="keywordflow">if</span>( <a class="code" href="functions_8php.html#a3">check_status</a>()==<span class="stringliteral">"Current Status:     Cleared"</span>)
00042 {       
00043         <a class="code" href="functions_8php.html#a8">show_results</a>($current_directory);
00044         echo <span class="stringliteral">"&lt;center&gt;&lt;table&gt;"</span>;
00045         echo <span class="stringliteral">"&lt;tr&gt;&lt;td align=\"center\"&gt;&lt;img src=\"egee.jpg\" alt=\"[EGEE]\"&gt;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;"</span>;
00046         echo <span class="stringliteral">"&lt;/table&gt;&lt;/center&gt;"</span>;
00047         echo <span class="stringliteral">"&lt;p&gt;&lt;a href=\"http://validator.w3.org/check?uri=referer\"&gt;&lt;img border=\"0\" "</span>;
00048         echo <span class="stringliteral">"src=\"http://www.w3.org/Icons/valid-html401\"alt=\"Valid HTML 4.01!\" height=\"31\" width=\"88\"&gt;&lt;/a&gt; "</span>;
00049         echo <span class="stringliteral">"&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;"</span>;
<a name="l00050"></a><a class="code" href="results_8php.html#a1">00050</a>         <a class="code" href="results_8php.html#a1">exit</a>;
00051 }
00052 
00053 
00054 <span class="comment">// If the job is not 'Cleared', we continue. First we check the grid job identifier</span>
00055 <span class="keywordflow">if</span>( file_exists(<span class="stringliteral">"./tinker/identifier.txt"</span>) )
00056 {       
00057         <span class="comment">// This function opens the 'child' process, is a ssh connection with the User Interface</span>
00058         open_connection($server, $wd_path, $process, $descriptorspec, $pipes);
00059 
00060         <span class="comment">// Enter the Grid!!!</span>
00061         enter_grid($pipes, $grid_pass);
00062         
00063         <span class="comment">// We need the job identifier to run retrieve all the job information   </span>
00064         <a class="code" href="functions_8php.html#a2">job_identifier</a>();
00065         
00066         <span class="comment">// Job status output</span>
00067         fwrite($pipes[0], <span class="stringliteral">"edg-job-status $identifier &gt; $current_directory/gramm/status.txt\n"</span>);
00068         
00069         <span class="comment">// We wait until the file is available</span>
00070         <span class="keywordflow">while</span> (!file_exists(<span class="stringliteral">"./tinker/status.txt"</span>))
00071         {
00072                 sleep(1);       
00073         }
00074         
00075         <span class="comment">// We check again the job status...</span>
<a name="l00076"></a><a class="code" href="results_8php.html#a2">00076</a>         <a class="code" href="results_8php.html#a2">$status</a>=<a class="code" href="functions_8php.html#a3">check_status</a>();
00077         
00078 } <span class="keywordflow">else</span>
00079 {
00080         echo <span class="stringliteral">"&lt;h1&gt;Error, there is no job identifier file!!!&lt;/h1&gt;&lt;br /&gt;\n"</span>;
00081         <a class="code" href="results_8php.html#a1">exit</a>; 
00082 }
00083 
00084 <span class="comment">// We have a new status</span>
00085 <span class="keywordflow">if</span>(<a class="code" href="results_8php.html#a2">$status</a>==<span class="stringliteral">"Current Status:     Done (Success)"</span>)
00086 {       
00087         <span class="comment">// We control when we get the job output with the output.txt file</span>
00088         <span class="comment">// If output.txt don't exists we have to execute 'edg-job-get-output'</span>
00089         <span class="keywordflow">if</span> (!file_exists(<span class="stringliteral">"./output.txt"</span>))
00090         {       
00091                 <span class="comment">// Get the job output</span>
00092                 fwrite($pipes[0], <span class="stringliteral">"edg-job-get-output --dir $current_directory $identifier &gt; $current_directory/output.txt\n"</span>);
00093                 
00094                 <span class="comment">// We wait until the file is available</span>
00095                 <span class="keywordflow">while</span> (!file_exists(<span class="stringliteral">"./output.txt"</span>))
00096                 {
00097                         sleep(1);       
00098                 }
00099                 
00100                 echo <span class="stringliteral">"&lt;pre&gt;\n"</span>;
00101                                 <span class="comment">//We read the middleware output</span>
00102                                 readfile(<span class="stringliteral">"./output.txt"</span>);
00103                 echo <span class="stringliteral">"&lt;/pre&gt;\n"</span>;
00104         }
00105         
00106         <span class="comment">// We can show the files if they are unpacked only!!!</span>
00107         <span class="keywordflow">if</span> (<a class="code" href="functions_8php.html#a7">unpack_results</a>()==<span class="stringliteral">"OK"</span>)
00108         {
00109                 <a class="code" href="functions_8php.html#a8">show_results</a>();
00110         } <span class="keywordflow">else</span>
00111         {
00112                 echo <span class="stringliteral">"&lt;center&gt;&lt;h2&gt;Please reload this page to show results. GridGramm is unpacking the results.&lt;/h2&gt;&lt;/center&gt;"</span>;
00113         }
00114 } <span class="keywordflow">else</span>
00115 {       
00116         echo <span class="stringliteral">"&lt;center&gt;&lt;table border=2&gt;"</span>;
00117         echo <span class="stringliteral">"&lt;tr&gt;&lt;td&gt;"</span>; 
00118                 echo <span class="stringliteral">"&lt;pre&gt;\n"</span>;
00119                         <span class="comment">//We read the middleware output</span>
00120                         readfile(<span class="stringliteral">"./gramm/submit.txt"</span>);
00121                 echo <span class="stringliteral">"&lt;/pre&gt;\n"</span>;
00122         echo <span class="stringliteral">"&lt;/td&gt;&lt;/tr&gt;"</span>;
00123         echo <span class="stringliteral">"&lt;/table&gt;&lt;/center&gt;"</span>;
00124         echo <span class="stringliteral">"&lt;hr&gt;"</span>;
00125         echo <span class="stringliteral">"&lt;center&gt;&lt;h2&gt;GridGramm results are not available. $status&lt;/h2&gt;&lt;/center&gt;"</span>;
00126         echo <span class="stringliteral">"&lt;center&gt;&lt;h1&gt;Please, bookmark this page. This page is updated every 15 seconds.&lt;/h1&gt;&lt;/center&gt;"</span>;
00127 }
00128 
00129 fwrite($pipes[0], <span class="stringliteral">"grid-proxy-destroy\n"</span>);
00130 
00131 <span class="comment">// Closes the ssh connection </span>
00132 close_connection($process, $descriptorspec, $pipes);    
00133 ?&gt;
00134 &lt;center&gt;
00135 &lt;table&gt;
00136 &lt;tr&gt;
00137         &lt;td align=center&gt;&lt;img src=<span class="stringliteral">"egee.jpg"</span> alt=<span class="stringliteral">"[EGEE]"</span>&gt;&lt;/a&gt;
00138         &lt;/td&gt;
00139 &lt;/tr&gt;
00140 &lt;/table&gt;
00141 &lt;p&gt;
00142         &lt;a href=<span class="stringliteral">"http://validator.w3.org/check?uri=referer"</span>&gt;
00143         &lt;img border=<span class="stringliteral">"0"</span> src=<span class="stringliteral">"http://www.w3.org/Icons/valid-html401"</span>alt=<span class="stringliteral">"Valid HTML 4.01!"</span> height=<span class="stringliteral">"31"</span> width=<span class="stringliteral">"88"</span>&gt;&lt;/a&gt;
00144 &lt;/p&gt;
00145 &lt;/center&gt;
00146 
00147 &lt;/body&gt;
00148 &lt;/html&gt;
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Apr 21 15:51:36 2005 for egTinker by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
